name: Increment Version

runs:
  using: "composite"
  steps:
    - name: Configure Git
      run: |
        git config --global user.email "${{ secrets.GIT_USER_EMAIL }}"
        git config --global user.name "${{ secrets.GIT_USER_NAME }}"
      shell: bash
    - name: Increment Beta Version
      run: |
        CURRENT_VERSION=$(node -pe "require('./package.json').version")
        BETA_REGEX="[0-9]+\.[0-9]+\.[0-9]+\-beta\.[0-9]+"
        if [[ ${CURRENT_VERSION} =~ ${BETA_REGEX} ]];
        then
          npm --no-git-tag-version version prerelease --preid=beta
        else
          npm --no-git-tag-version version preminor --preid=beta
        fi
        CURRENT_VERSION=$(node -pe "require('./package.json').version")
        git commit -a -m $"Build ${CURRENT_VERSION}"
        git push --set-upstream origin develop
      shell: bash
